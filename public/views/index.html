<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<!-- This section gives the unauthenticated user access to all of the files that are stored in the Content folder.  -->
	<location path="/public">
		<system.web>
			<authorization>
				<allow users="*" />
			</authorization>
		</system.web>
	</location>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<title>Audio Insights</title>

	<style>
		body, html {
			height: 100%;
			margin: 0;
			font-family: Arial, Helvetica, sans-serif;
		}
		
		* {
			box-sizing: border-box;
		}
		
		.bg-image {
			/* The image used */
			background-image: url("{{ url_for('public', path='/images/background-image.png') }}");
			
			
			/* Full width */
			width: 100%;
			height: 100%; 
			
			/* Center and scale the image nicely */
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}
		.simple-spacing{
			margin: 3px;
		}
		</style>
</head>

<body class="bg-image">
	<div class="container">
		<div class="center-block text-center">
			<img src="{{ url_for('public', path='/images/nav-logo.png') }}" class="img-fluid" alt="page-logo">
			<div class="controllers simple-spacing"></div>
			<div class="display simple-spacing"></div>
			<form id="form_audio" class="center-block text-center" action="" method="post" enctype="multipart/form-data">
				<div class="col-auto">
						<input type="file" accept="audio/*" id="input_audio" class="inputs form-control simple-spacing p-1" name="audio_file" capture>
						<button type="submit" id="button_audio" class="listen-button btn btn-primary simple-spacing">Submit</button>
					</div>	
			</form>
			<div class="row justify-content-center">
				<div class="text-center mx-auto d-block" id="image">
				</div>
		</div>
			<div><h3 id="test">Response Data is displayed here...</h3></div>
			<div class="footer"></div>
		</div>
	</div>
</body>
		
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{{ url_for('public', path='/javascript/vrecorder.js') }}"></script>
<script>
	var form = document.getElementById('form_audio');
	var fileSelect = document.getElementById('input_audio');
	var uploadButton = document.getElementById('button_audio');
	form.onsubmit = function (event) {
		event.preventDefault();

		// Update button text.
		uploadButton.innerHTML = 'Uploading...';

		const audioURL = document.querySelector('audio')
		var audio = null;
		// Return if no file is selected.
		if (fileSelect.files.length > 0) {
			audio = fileSelect.files[0];
		}
		if (audioURL != null) {
			<!-- audio = audioURL.src; -->
		}
		if (audio == null) {
			return;
		}
		// Create a new FormData object.
		var formData = new FormData();

		// Add the file to the request.
		formData.append('audio_file', audio, audio.name);
		// Set up the request.
		var xhr = new XMLHttpRequest();
		// Open the connection.
		xhr.open('POST', '/uploadfile/', true);
		// Set up a handler for when the request finishes.
		xhr.onload = function () {
			if (xhr.status === 200) {
				// File(s) uploaded.
				uploadButton.innerHTML = 'Upload';
				var response = JSON.parse(xhr.response);
				
				// Displaying the image
				var img = new Image();
				img.src = 'data:image/png;base64,' + response.Image;
				$("#test").html(response.Prediction.replace(/\n/g, '<br/>'));

				// If you want to append the image to a specific HTML element, you can do this:
				// Assume the element has the id 'image'
				var parent = document.getElementById('image');
				// Remove all child nodes
				while (parent.firstChild) {
						parent.removeChild(parent.firstChild);
				}
				// Append the new image
				parent.appendChild(img);

			} else {
				alert('An error occurred!');
			}
		};
		// Send the Data.
		xhr.send(formData);
	}
</script>

</html>