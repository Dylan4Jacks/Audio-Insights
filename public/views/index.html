<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<!-- This section gives the unauthenticated user access to all of the files that are stored in the Content folder.  -->
	<location path="/public">
		<system.web>
			<authorization>
				<allow users ="*" />
			</authorization>
		</system.web>
	</location>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" href="{{ url_for('public', path='/styles.css') }}" />
	<title>Audio Insights</title>
</head>

<body>
	<div class="container">
		<div class="header">
			<div class="nav">
				<div class="nav-left">
					<a>
						<img src="{{ url_for('public', path='/images/nav-logo.png') }}" alt="nav-logo">
						 <div>Audio Insights</div>
						</a>
				</div>
				<div class="nav-right">
					<a>Help</a>
					
				</div>
			</div>
		</div>
		<div class="main">
			<div class="center-screen">
				<div class="audio-symbol">
					<img src="{{ url_for('public', path='/images/nav-logo.png') }}" alt="page-logo">
				</div>
				<div class="title-text">Audio Insights</div>
				<div class="inputs-container">
					<form id="uploadform" enctype="multipart/form-data" method="post" action="#">
						<input type="file" accept="audio/*" id="input_audio" class="inputs" capture>
						
					</form>
				</div>
				<div class="audio_display"></div>
				<div class="audio_player"></div>
				<button name="Listen" class="listen-button" id="request_btn" onclick="">Send Request</button>
				<button name="Upload" class="listen-button" id="upload_file" onclick="">Upload File</button>
				<h3 id="test">Response Data is displayed here...</h3>
				<div class="display">
				</div>
				<div class="controllers">
				</div>
			</div>
		</div>
		<div class="footer"></div>
	</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{{ url_for('public', path='/javascript/vrecorder.js') }}"></script>
<script>
	$(document).ready(function(){
	$("#request_btn").click(function(){
			var reader = new FileReader();
				reader.onload = function (e) {
				var objectData = {
				input_text: $('#input_text').val(),
				audio: reader.result.split(',')[1]              
			};
			var objectDataString = JSON.stringify(objectData);
			$.ajax({
							type: "POST",
							url: "/make_post", //getUrl.protocol + "//" + getUrl.host
							dataType: "json",
							data: objectDataString,
							success: function (data, status) {
					$("#test").html(JSON.stringify(data));
					console.log(data)
									 alert(status);
							},
							error: function (data, status) {
								 alert(status);
							}
					});
				};
				reader.readAsDataURL($('#input_audio')[0].files[0]);
	});
	});
</script>
<script>
	$(document).ready(function(){
		$("#upload_file").click(function(){
			const audioFile = document.querySelector('#input_audio').files[0];
			const reader = new FileReader();
			reader.readAsArrayBuffer(audioFile);
			reader.onload = function() {
				const audioContext = new AudioContext();
				audioContext.decodeAudioData(reader.result, function(decodedData) {
					const wavBlob = encodeWAV(decodedData);
					$.ajax({
						type: "POST",
						url: "/files",
						data: audioRecorder.forceDownload(blob, 'output.wav')
						});
				});
			};
			
		});
	});
</script>
</html>